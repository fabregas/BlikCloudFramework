--   -------------------------------------------------- 
--   Generated by Enterprise Architect Version 7.5.845
--   Created On : суббота, 07 Август, 2010 
--   DBMS       : PostgreSQL 
--   -------------------------------------------------- 




--  Create Tables 
CREATE TABLE BF_ActiveSession ( 
	session_guid char(16) NOT NULL,
	user_id integer NOT NULL,
	session_start timestamp NOT NULL
)
;

CREATE SEQUENCE BF_Audit_id_seq INCREMENT 1 START 1
;

CREATE TABLE BF_Audit ( 
	id bigint DEFAULT NEXTVAL('BF_Audit_id_seq'::TEXT) NOT NULL,
	object_type smallint NOT NULL,
	object_id bigint NOT NULL,
	audit_type smallint NOT NULL,
	datetime timestamp NOT NULL,
	audit_message varchar(1024)
)
;

CREATE TABLE BF_AuditObject ( 
	id smallint NOT NULL,
	sid varchar(10) NOT NULL,
	name varchar(50) NOT NULL,
	description varchar(1024)
)
;

CREATE SEQUENCE BF_AuditType_id_seq INCREMENT 1 START 1
;

CREATE TABLE BF_AuditType ( 
	id smallint DEFAULT NEXTVAL('BF_AuditType_id_seq'::TEXT) NOT NULL,
	sid varchar(20) NOT NULL,
	name varchar(50) NOT NULL,
	description varchar(1024)
)
;

CREATE SEQUENCE BF_Departament_id_seq INCREMENT 1 START 1
;

CREATE TABLE BF_Departament ( 
	id integer DEFAULT NEXTVAL('BF_Departament_id_seq'::TEXT) NOT NULL,
	name varchar(100) NOT NULL,
	description varchar(1024),
	parent_id integer
)
;

CREATE TABLE BF_DepartamentRole ( 
	departament_id integer NOT NULL,
	role_id integer NOT NULL
)
;

CREATE SEQUENCE BF_Form_id_seq INCREMENT 1 START 1
;

CREATE TABLE BF_Form ( 
	id integer DEFAULT NEXTVAL('BF_Form_id_seq'::TEXT) NOT NULL,
	name varchar(50) NOT NULL,
	version varchar(10) NOT NULL,
	read_role integer,
	write_role integer,
	status smallint,    --  1 - active 2 - not active 
	checksum varchar(32),
	form_source bytea NOT NULL
)
;
COMMENT ON COLUMN BF_Form.status
    IS '1 - active 2 - not active'
;

CREATE SEQUENCE BF_Menu_id_seq INCREMENT 1 START 1
;

CREATE TABLE BF_Menu ( 
	id integer DEFAULT NEXTVAL('BF_Menu_id_seq'::TEXT) NOT NULL,
	parent_id integer,
	role_id integer,
	form_id integer,
	name varchar(20) NOT NULL,
	help_description varchar(1024)
)
;

CREATE SEQUENCE BF_Position_id_seq INCREMENT 1 START 1
;

CREATE TABLE BF_Position ( 
	id integer DEFAULT NEXTVAL('BF_Position_id_seq'::TEXT) NOT NULL,
	name varchar(50) NOT NULL,
	description varchar(1024),
	parent_id integer
)
;

CREATE TABLE BF_PositionRole ( 
	position_id integer NOT NULL,
	role_id integer NOT NULL
)
;

CREATE SEQUENCE BF_Role_id_seq INCREMENT 1 START 1
;

CREATE TABLE BF_Role ( 
	id integer DEFAULT NEXTVAL('BF_Role_id_seq'::TEXT) NOT NULL,
	sid varchar(20) NOT NULL,
	name varchar(20),
	description varchar(1024)
)
;

CREATE SEQUENCE BF_URL_id_seq INCREMENT 1 START 1
;

CREATE TABLE BF_URL ( 
	id integer DEFAULT NEXTVAL('BF_URL_id_seq'::TEXT) NOT NULL,
	sid varchar(10) NOT NULL,
	service_url varchar(255) NOT NULL,
	description varchar(1024)
)
;

CREATE SEQUENCE BF_User_id_seq INCREMENT 1 START 1
;

CREATE TABLE BF_User ( 
	id integer DEFAULT NEXTVAL('BF_User_id_seq'::TEXT) NOT NULL,
	departament_id integer NOT NULL,
	position_id integer NOT NULL,
	status smallint DEFAULT 1 NOT NULL,    --  1 - active user 2 - blocked user 3 - archive user 
	login varchar(20) NOT NULL,
	password_checksum varchar(32) NOT NULL
)
;
COMMENT ON COLUMN BF_User.status
    IS '1 - active user 2 - blocked user 3 - archive user'
;


--  Create Primary Key Constraints 
ALTER TABLE BF_ActiveSession ADD CONSTRAINT PK_BF_ActiveSession 
	PRIMARY KEY (session_guid)
;


ALTER TABLE BF_Audit ADD CONSTRAINT PK_BF_Audit 
	PRIMARY KEY (id)
;


ALTER TABLE BF_AuditObject ADD CONSTRAINT PK_BF_AuditObject 
	PRIMARY KEY (id)
;


ALTER TABLE BF_AuditType ADD CONSTRAINT PK_BF_AuditType 
	PRIMARY KEY (id)
;


ALTER TABLE BF_Departament ADD CONSTRAINT PK_Departament 
	PRIMARY KEY (id)
;


ALTER TABLE BF_DepartamentRole ADD CONSTRAINT PK_BF_DepartamentRole 
	PRIMARY KEY (departament_id, role_id)
;


ALTER TABLE BF_Form ADD CONSTRAINT PK_BF_Form 
	PRIMARY KEY (id)
;


ALTER TABLE BF_Menu ADD CONSTRAINT PK_Menu 
	PRIMARY KEY (id)
;


ALTER TABLE BF_Position ADD CONSTRAINT PK_Position 
	PRIMARY KEY (id)
;


ALTER TABLE BF_PositionRole ADD CONSTRAINT PK_BF_PositionRole 
	PRIMARY KEY (position_id, role_id)
;


ALTER TABLE BF_Role ADD CONSTRAINT PK_Role 
	PRIMARY KEY (id)
;


ALTER TABLE BF_URL ADD CONSTRAINT PK_BF_URL 
	PRIMARY KEY (id)
;


ALTER TABLE BF_User ADD CONSTRAINT PK_User 
	PRIMARY KEY (id)
;



--  Create Indexes 
ALTER TABLE BF_AuditObject
	ADD CONSTRAINT UQ_BF_AuditObject_sid UNIQUE (sid)
;
ALTER TABLE BF_AuditType
	ADD CONSTRAINT UQ_BF_AuditType_sid UNIQUE (sid)
;
ALTER TABLE BF_Role
	ADD CONSTRAINT UQ_Role_sid UNIQUE (sid)
;
ALTER TABLE BF_URL
	ADD CONSTRAINT UQ_BF_URL_sid UNIQUE (sid)
;

--  Create Foreign Key Constraints 
ALTER TABLE BF_ActiveSession ADD CONSTRAINT FK_ActiveSession_User 
	FOREIGN KEY (user_id) REFERENCES BF_User (id)
;

ALTER TABLE BF_Audit ADD CONSTRAINT FK_Audit_AuditObject 
	FOREIGN KEY (object_type) REFERENCES BF_AuditObject (id)
;

ALTER TABLE BF_Audit ADD CONSTRAINT FK_Audit_AuditType 
	FOREIGN KEY (audit_type) REFERENCES BF_AuditType (id)
;

ALTER TABLE BF_Departament ADD CONSTRAINT FK_Departament_Departament 
	FOREIGN KEY (parent_id) REFERENCES BF_Departament (id)
;

ALTER TABLE BF_DepartamentRole ADD CONSTRAINT FK_DepartamentRole_Departament 
	FOREIGN KEY (departament_id) REFERENCES BF_Departament (id)
;

ALTER TABLE BF_DepartamentRole ADD CONSTRAINT FK_DepartamentRole_Role 
	FOREIGN KEY (role_id) REFERENCES BF_Role (id)
;

ALTER TABLE BF_Form ADD CONSTRAINT FK_Form_ReadRole 
	FOREIGN KEY (read_role) REFERENCES BF_Role (id)
;

ALTER TABLE BF_Form ADD CONSTRAINT FK_Form_WriteRole 
	FOREIGN KEY (write_role) REFERENCES BF_Role (id)
;

ALTER TABLE BF_Menu ADD CONSTRAINT FK_Menu_Form 
	FOREIGN KEY (form_id) REFERENCES BF_Form (id)
;

ALTER TABLE BF_Menu ADD CONSTRAINT FK_Menu_Role 
	FOREIGN KEY (role_id) REFERENCES BF_Role (id)
;

ALTER TABLE BF_Position ADD CONSTRAINT FK_Position_Position 
	FOREIGN KEY (parent_id) REFERENCES BF_Position (id)
;

ALTER TABLE BF_PositionRole ADD CONSTRAINT FK_PositionRole_Position 
	FOREIGN KEY (position_id) REFERENCES BF_Position (id)
;

ALTER TABLE BF_PositionRole ADD CONSTRAINT FK_PositionRole_Role 
	FOREIGN KEY (role_id) REFERENCES BF_Role (id)
;

ALTER TABLE BF_User ADD CONSTRAINT FK_User_Departament 
	FOREIGN KEY (departament_id) REFERENCES BF_Departament (id)
;

ALTER TABLE BF_User ADD CONSTRAINT FK_User_Position 
	FOREIGN KEY (position_id) REFERENCES BF_Position (id)
;
